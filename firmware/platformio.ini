; PlatformIO Project Configuration File
; FAME Smart Blinds - Smart Blind Controller
; https://docs.platformio.org/page/projectconf.html

[env:xiaoesp32c3]
platform = espressif32
board = seeed_xiao_esp32c3
framework = arduino

; Serial monitor settings
monitor_speed = 115200
monitor_filters = esp32_exception_decoder, colorize

; Upload settings - use lower speed for reliable USB CDC uploads
upload_speed = 115200
upload_before_reset = usb_reset
upload_after_reset = hard_reset

; Use partition scheme with OTA support (two app partitions)
; min_spiffs.csv: 1.9MB app0, 1.9MB app1, 190KB SPIFFS
board_build.partitions = min_spiffs.csv

; Build flags
build_flags =
    -DCORE_DEBUG_LEVEL=2
    -DARDUINO_USB_CDC_ON_BOOT=1
    -DARDUINO_USB_MODE=1
    -Os
    ; AsyncTCP tuning for multiple SSE clients
    -DCONFIG_ASYNC_TCP_MAX_ACK_TIME=5000
    -DCONFIG_ASYNC_TCP_PRIORITY=10
    -DCONFIG_ASYNC_TCP_QUEUE_SIZE=64
    -DCONFIG_ASYNC_TCP_RUNNING_CORE=1

; Library dependencies
lib_deps =
    https://github.com/ftservo/FTServo_Arduino.git
    knolleary/PubSubClient@^2.8
    bblanchon/ArduinoJson@^7.0.0
    https://github.com/me-no-dev/ESPAsyncWebServer.git
    https://github.com/me-no-dev/AsyncTCP.git

; Extra build options for async libraries
build_unflags = -std=gnu++11
build_src_flags = -std=gnu++17

; Create merged firmware binary for easy flashing
; Output: .pio/build/xiaoesp32c3/merged-flash.bin (flash at 0x0)
extra_scripts = post:merge_firmware.py
